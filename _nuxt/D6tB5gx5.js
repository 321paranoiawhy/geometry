import{u as U,c as M,E as _,a as A,v as V,r as $}from"./DcuUOxds.js";import{f as N,r as f,u as J,l as T,m as q,n as O,o as k,c as S,F as H,j as K,b as Q,w as X,a as W,t as Y,q as Z,h as g,s as ee,p as ae,e as oe}from"./W7fWJJKc.js";import{w as te,u as ie}from"./Ds_-Ua9Z.js";import{_ as ne}from"./DlAUqK2U.js";const se=h=>(ae("data-v-1072276b"),h=h(),oe(),h),le={"flex-center":""},de=se(()=>W("img",{"i-mdi-tray-arrow-down":"",alt:"下载"},null,-1)),re={"ml-6px":"","flex-self-baseline":""},ue={"mt-16px":"","w-fit":""},ce=["width","height"],ge=["src","alt","width","height"],he=N({__name:"regular-polygon",props:{minCanvasSize:{default:500},sideCounts:{default:50},sideWidth:{default:1},sideColor:{default:"black"},diagonalWidth:{default:1},diagonalColor:{default:"black"},minSideLength:{default:100},onlyVertex:{type:Boolean,default:!0},animation:{type:Boolean,default:!1},startDirection:{},clockwise:{type:Boolean},lazy:{type:Boolean,default:!0}},setup(h){const a=h,m=`regular-polygon-${a.sideCounts}`,E=U(),C=f(!1),L=f(0),p=f("");J({script:[{key:"canvas2svg",innerHTML:M},{key:"gif",src:"https://cdn.bootcdn.net/ajax/libs/gif.js/0.2.0/gif.js",onload:()=>{E.setGifJsLoaded(!0)},onerror:()=>{_.error({message:"Fail to load gif.js from CDN"})}}]});const j=f(0),d=T(()=>{const e=a.sideCounts,o=a.minSideLength/Math.sin(2*Math.PI/e);return j.value=o,o>a.minCanvasSize?o:a.minCanvasSize}),s=T(()=>{const e=[],t=j.value/2,o=2*Math.PI/a.sideCounts;for(let l=0;l<a.sideCounts;l++){const i=l*o;e[l]={x:+(t*Math.sin(i)).toFixed(3),y:-(t*Math.cos(i)).toFixed(3)}}return e}),r=f();function x(){}q(async()=>{if(!r.value.getContext)return;const e=r.value.getContext("2d",{alpha:!1});P(e),await w(e,{sideCounts:a.sideCounts,sideWidth:a.sideWidth,sideColor:a.sideColor}),await y(e,{sideCounts:a.sideCounts,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor}),window.addEventListener("resize",x)}),O(()=>{window.removeEventListener("resize",x)}),te(()=>[a.sideCounts,a.sideColor,a.diagonalColor,a.animation],async()=>{const e=r.value.getContext("2d",{alpha:!1});R(e),p.value="",await w(e,{sideCounts:a.sideCounts,sideWidth:a.sideWidth,sideColor:a.sideColor}),await y(e,{sideCounts:a.sideCounts,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor})},{debounce:500,maxWait:1e3,immediate:!1});async function w(e,t,o=()=>{}){return new Promise(async l=>{const{sideCounts:i,sideWidth:u,sideColor:v}=t;if(e.lineWidth=u,e.strokeStyle=v,e.beginPath(),e.moveTo(s.value[0].x,s.value[0].y),a.animation){for(let n=0;n<i-1;n++)await G(e,s.value[n],s.value[n+1]),o();await G(e,s.value[s.value.length-1],s.value[0]),o()}else{for(let n=0;n<i;n++)e.lineTo(s.value[n].x,s.value[n].y),o();e.lineTo(s.value[0].x,s.value[0].y),o(),e.stroke()}l(!0)})}async function y(e,t,o=()=>{}){return new Promise(async l=>{const{sideCounts:i,diagonalWidth:u,diagonalColor:v}=t;e.lineWidth=u,e.strokeStyle=v;for(let n=0;n<i-1;n++)for(let c=n+2;c<i&&!(n===0&&c===i-1);c++)a.animation?(await G(e,s.value[n],s.value[c]),o()):(e.beginPath(),e.moveTo(s.value[n].x,s.value[n].y),e.lineTo(s.value[c].x,s.value[c].y),o(),e.stroke());l(!0)})}function G(e,t,o){return new Promise(l=>{e.beginPath(),e.moveTo(t.x,t.y);const i=250,u=o.x-t.x,v=o.y-t.y,n=Date.now(),c=()=>{const F=(Date.now()-n)/i;if(F>1){e.lineTo(o.x,o.y),e.stroke(),l(!0);return}e.lineTo(t.x+u*F,t.y+v*F),e.stroke(),requestAnimationFrame(c)};requestAnimationFrame(c)})}function P(e){e.lineJoin="miter",e.fillStyle="white",e.fillRect(0,0,d.value,d.value),e.translate(d.value/2,d.value/2),e.scale(window.devicePixelRatio,window.devicePixelRatio)}const B=["JPEG","PNG","SVG","GIF","BASE64"];async function D(){const e=new C2S(d.value,d.value);P(e),await w(e,{sideCounts:a.sideCounts,sideWidth:a.sideWidth,sideColor:a.sideColor}),await y(e,{sideCounts:a.sideCounts,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor});const t=e.getSerializedSvg(),o=new Blob([t],{type:"image/scg+xml;charset=utf-8"}),l=URL.createObjectURL(o);b(l,`${m}.svg`)}async function I(e){if(!(E.isGifJsLoaded&&typeof GIF=="function"))return _.error({message:"Please wait until gif.js loaded"});const o=new GIF({workerScript:URL.createObjectURL(new Blob([$],{type:"application/javascript"})),workers:2,repeat:0,background:"#fff",quality:10,debug:!1,width:d.value,height:d.value});o.on("start",()=>{C.value=!0}),o.on("progress",i=>{L.value=i}),o.on("finished",i=>{C.value=!1;const u=URL.createObjectURL(i);p.value=u,b(u,`${m}.gif`),o.abort()}),o.on("abort",()=>{C.value=!1,L.value=0});const l=()=>{o.addFrame(e,{copy:!0,delay:a.sideCounts>10?100:300})};R(e),await w(e,{sideCounts:a.sideCounts,sideWidth:a.sideWidth,sideColor:a.sideColor},l),await y(e,{sideCounts:a.sideCounts,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor},l),o.render()}function R(e){r.value.width=r.value.width,r.value.height=r.value.height,P(e)}async function z(e){let t="";switch(e){case"GIF":I(r.value.getContext("2d"));break;case"JPEG":t=r.value.toDataURL("image/jpeg",1),b(t,`${m}.jpeg`);break;case"PNG":t=r.value.toDataURL("image/png",1),b(t,`${m}.png`);break;case"SVG":D();break;case"BASE64":t=r.value.toDataURL("image/png",1);const{copy:o}=ie({legacy:!0});o(t).then(()=>{_.success({message:"Copied!"})}).catch(()=>{_.error({message:"Fail to copy"})});break}}function b(e,t){const o=document.createElement("a");o.download=t,o.href=e,document.body.appendChild(o),o.click(),document.body.removeChild(o)}return(e,t)=>{const o=A,l=V;return k(),S("div",null,[(k(),S(H,null,K(B,i=>Q(o,{key:i,type:"primary",onClick:u=>z(i)},{default:X(()=>[W("div",le,[de,W("span",re,Y(i),1)])]),_:2},1032,["onClick"])),64)),Z((k(),S("div",ue,[W("canvas",{ref_key:"canvas",ref:r,width:g(d),height:g(d)},null,8,ce)])),[[l,g(C)&&{text:`${+g(L).toFixed(2)*100}%`}]]),g(p)?(k(),S("img",{key:0,src:g(p),alt:`regular-polygon-${e.sideCounts}.gif`,width:g(d),height:g(d)},null,8,ge)):ee("",!0)])}}}),we=ne(he,[["__scopeId","data-v-1072276b"]]);export{we as _};
