import{u as N,c as q,E as k,a as J,v as O,r as H}from"./DGE65cC5.js";import{f as K,r as m,u as Q,l as M,m as X,n as Y,o as S,c as W,F as Z,j as ee,b as ae,w as te,a as P,t as ie,q as oe,h as u,s as ne,p as se,e as re}from"./Ka5Y-oHc.js";import{w as le,u as ce}from"./CV8Xs3yA.js";import{_ as de}from"./DlAUqK2U.js";const ue=g=>(se("data-v-b92ebf89"),g=g(),re(),g),ve={"flex-center":""},fe=ue(()=>P("img",{"i-mdi-tray-arrow-down":"",alt:"下载"},null,-1)),he={"ml-6px":"","flex-self-baseline":""},ge={"mt-16px":"","w-fit":""},me=["width","height"],pe=["src","alt","width","height"],we=K({__name:"custom-circle",props:{radius:{default:100},minCanvasSize:{default:500},vertices:{default:50},sideWidth:{default:1},circleColor:{default:"black"},diagonalWidth:{default:1},diagonalColor:{default:"black"},minSideLength:{default:100},onlyVertex:{type:Boolean,default:!0},animation:{type:Boolean,default:!1},startDirection:{},clockwise:{type:Boolean},lazy:{type:Boolean,default:!0}},setup(g){const a=g,p=`circle-${a.vertices}`,G=N(),w=m(!1),L=m(0),y=m("");Q({script:[{key:"canvas2svg",innerHTML:q},{key:"gif",src:"https://cdn.bootcdn.net/ajax/libs/gif.js/0.2.0/gif.js",onload:()=>{G.setGifJsLoaded(!0)},onerror:()=>{k.error({message:"Fail to load gif.js from CDN"})}}]});const T=m(0),n=M(()=>{const e=a.vertices,t=a.minSideLength/Math.sin(2*Math.PI/e);return T.value=t,t>a.minCanvasSize?t:a.minCanvasSize}),h=M(()=>{const e=[],i=a.radius,t=2*Math.PI/a.vertices;for(let o=0;o<a.vertices;o++){const s=o*t;e[o]={x:+(i*Math.sin(s)).toFixed(3),y:-(i*Math.cos(s)).toFixed(3)}}return e}),r=m();function I(){}X(async()=>{if(!r.value.getContext)return;const e=r.value.getContext("2d",{alpha:!1});F(e),await C(e,{vertices:a.vertices,sideWidth:a.sideWidth,circleColor:a.circleColor}),await b(e,{vertices:a.vertices,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor}),window.addEventListener("resize",I)}),Y(()=>{window.removeEventListener("resize",I)}),le(()=>[a.vertices,a.circleColor,a.diagonalColor,a.animation],async()=>{const e=r.value.getContext("2d",{alpha:!1});B(e),y.value="",await C(e,{vertices:a.vertices,sideWidth:a.sideWidth,circleColor:a.circleColor}),await b(e,{vertices:a.vertices,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor})},{debounce:500,maxWait:1e3,immediate:!1});function B(e){r.value.width=r.value.width,r.value.height=r.value.height,F(e)}async function C(e,i,t=()=>{}){return new Promise(async o=>{const{vertices:s,sideWidth:l,circleColor:v}=i;e.lineWidth=l,e.strokeStyle=v,e.beginPath(),a.animation?await A(e,{x:0,y:0},a.radius,-Math.PI/2,3*Math.PI/2,t):(e.arc(0,0,a.radius,-Math.PI/2,3*Math.PI/2,!1),e.stroke()),o(!0)})}async function b(e,i,t=()=>{}){return new Promise(async o=>{const{vertices:s,diagonalWidth:l,diagonalColor:v}=i;e.lineWidth=l,e.strokeStyle=v;for(let c=0;c<s-1;c++)for(let d=c+2;d<s&&!(c===0&&d===s-1);d++)a.animation?(await x(e,h.value[c],h.value[d]),t()):(e.beginPath(),e.moveTo(h.value[c].x,h.value[c].y),e.lineTo(h.value[d].x,h.value[d].y),t(),e.stroke());o(!0)})}function A(e,i,t,o,s,l=()=>{}){return new Promise(v=>{e.beginPath();const c=s-o,d=2e3,R=Date.now();let f=o;const D=()=>{const E=(Date.now()-R)/d;if(E>1){e.arc(i.x,i.y,t,f,s,!1),e.stroke(),l(),v(!0);return}const j=o+E*c;e.arc(i.x,i.y,t,f,j,!1),f=j,e.stroke(),l(),requestAnimationFrame(D)};requestAnimationFrame(D)})}function x(e,i,t){return new Promise(o=>{e.beginPath(),e.moveTo(i.x,i.y);const s=300,l=t.x-i.x,v=t.y-i.y,c=Date.now(),d=()=>{const f=(Date.now()-c)/s;if(f>1){e.lineTo(t.x,t.y),e.stroke(),o(!0);return}e.lineTo(i.x+l*f,i.y+v*f),e.stroke(),requestAnimationFrame(d)};requestAnimationFrame(d)})}function F(e){e.lineJoin="miter",e.fillStyle="white",e.fillRect(0,0,n.value,n.value),e.translate(n.value/2,n.value/2),e.scale(window.devicePixelRatio,window.devicePixelRatio)}const z=["JPEG","PNG","SVG","GIF","BASE64"];async function U(){const e=new C2S(n.value,n.value);F(e),await C(e,{vertices:a.vertices,sideWidth:a.sideWidth,circleColor:a.circleColor}),await b(e,{vertices:a.vertices,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor});const i=e.getSerializedSvg(),t=new Blob([i],{type:"image/scg+xml;charset=utf-8"}),o=URL.createObjectURL(t);_(o,`${p}.svg`)}async function V(e){if(!(G.isGifJsLoaded&&typeof GIF=="function"))return k.error({message:"Please wait until gif.js loaded"});const t=new GIF({workerScript:URL.createObjectURL(new Blob([H],{type:"application/javascript"})),workers:2,repeat:0,background:"#fff",quality:10,debug:!1,width:n.value,height:n.value});t.on("start",()=>{w.value=!0}),t.on("progress",s=>{L.value=s}),t.on("finished",s=>{w.value=!1;const l=URL.createObjectURL(s);y.value=l,_(l,`${p}.gif`),t.abort()}),t.on("abort",()=>{w.value=!1,L.value=0});const o=()=>{t.addFrame(e,{copy:!0,delay:a.vertices>10?100:300})};e.fillStyle="#fff",e.clearRect(-n.value/2,-n.value/2,n.value,n.value),e.fillRect(-n.value/2,-n.value/2,n.value,n.value),await C(e,{vertices:a.vertices,sideWidth:a.sideWidth,circleColor:a.circleColor},o),await b(e,{vertices:a.vertices,diagonalWidth:a.diagonalWidth,diagonalColor:a.diagonalColor},o),t.render()}async function $(e){let i="";switch(e){case"GIF":V(r.value.getContext("2d"));break;case"JPEG":i=r.value.toDataURL("image/jpeg",1),_(i,`${p}.jpeg`);break;case"PNG":i=r.value.toDataURL("image/png",1),_(i,`${p}.png`);break;case"SVG":U();break;case"BASE64":i=r.value.toDataURL("image/png",1);const{copy:t}=ce({legacy:!0});t(i).then(()=>{k.success({message:"Copied!"})}).catch(()=>{k.error({message:"Fail to copy"})});break}}function _(e,i){const t=document.createElement("a");t.download=i,t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}return(e,i)=>{const t=J,o=O;return S(),W("div",null,[(S(),W(Z,null,ee(z,s=>ae(t,{key:s,type:"primary",onClick:l=>$(s)},{default:te(()=>[P("div",ve,[fe,P("span",he,ie(s),1)])]),_:2},1032,["onClick"])),64)),oe((S(),W("div",ge,[P("canvas",{ref_key:"canvas",ref:r,width:u(n),height:u(n)},null,8,me)])),[[o,u(w)&&{text:`${+u(L).toFixed(2)*100}%`}]]),u(y)?(S(),W("img",{key:0,src:u(y),alt:`regular-polygon-${e.vertices}.gif`,width:u(n),height:u(n)},null,8,pe)):ne("",!0)])}}}),Se=de(we,[["__scopeId","data-v-b92ebf89"]]);export{Se as _};
